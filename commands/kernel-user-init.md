---
description: Initialize user-level KERNEL foundations at ~/.claude/
allowed-tools: Read, Write, Bash, Glob, AskUserQuestion
---

# Initialize User-Level KERNEL

Create the universal foundation layer at `~/.claude/`. This is the always-present base layer that applies to ALL projects.

## Architecture

```
PRECEDENCE: Project > User > Plugin defaults

~/.claude/           <-- UNIVERSAL (this command)
├── CLAUDE.md        Always loaded in Claude Code
├── rules/           User rules (always loaded)
└── changelog.md     Track evolution

./CLAUDE.md          <-- PROJECT-SPECIFIC (kernel-init)
└── kernel/          Project methodology
```

## Step 1: Locate CODING-PROMPT-BANK

Search for the bank in order:
1. Plugin location: `kernel/banks/CODING-PROMPT-BANK.md`
2. User override: `~/.claude/CODING-PROMPT-BANK.md`

Read the entire bank. This is the substrate for building user config.

**Extract sections tagged `[USER-LEVEL]`:**
- CORE PHILOSOPHY
- GIT WORKFLOW: WORKTREE-BASED DEVELOPMENT
- DEFAULTS
- QUICK REFERENCE

## Step 2: Check Existing Installation

```bash
ls -la ~/.claude/ 2>/dev/null || echo "NOT_FOUND"
```

**If ~/.claude/CLAUDE.md exists:**

Ask user:
- "Update" - Backup current and regenerate
- "View" - Show current content
- "Cancel" - Exit without changes

**If NOT_FOUND:**
Proceed to create fresh installation.

## Step 3: Gather User Preferences (Optional)

Ask user if they want to customize preferences now or later:

**If now, ask about:**

1. **Verbosity**: How detailed should responses be?
   - Concise (terse, code-focused)
   - Balanced (explanations when helpful)
   - Detailed (thorough explanations)

2. **Platform**: Primary development environment?
   - macOS
   - Linux
   - Windows
   - Mixed

3. **Editor/IDE**: Primary tool?
   - VS Code
   - Terminal (vim/nvim/emacs)
   - JetBrains
   - Other

Store preferences for inclusion in generated CLAUDE.md.

**If later:** Use defaults, user can edit `~/.claude/CLAUDE.md` directly.

## Step 4: Backup (If Updating)

If updating existing installation:

1. Create backup directory:
   ```bash
   mkdir -p ~/.claude/backup
   ```

2. Backup current file with timestamp:
   ```bash
   cp ~/.claude/CLAUDE.md ~/.claude/backup/CLAUDE-$(date +%Y%m%d-%H%M%S).md
   ```

3. Append to changelog.

## Step 5: Create Directory Structure

```bash
mkdir -p ~/.claude/rules
mkdir -p ~/.claude/backup
```

## Step 6: Generate User CLAUDE.md

Build `~/.claude/CLAUDE.md` by extracting from CODING-PROMPT-BANK:

```markdown
# Universal Development Principles

These principles apply to ALL projects, regardless of stack or domain.

---

[INSERT: CORE PHILOSOPHY section from bank]

---

[INSERT: GIT WORKFLOW section from bank]

---

[INSERT: DEFAULTS section from bank]

---

## Response Preferences

[INSERT: User preferences from Step 3, or placeholder template]

---

## KERNEL Integration

When KERNEL is initialized in a project (`/kernel:init`), project-level config takes precedence over these user defaults.

**Layer hierarchy:**
1. Project `.claude/CLAUDE.md` + `kernel/` (highest priority)
2. User `~/.claude/CLAUDE.md` + `~/.claude/rules/` (this file)
3. Plugin defaults (lowest priority)

Project-specific rules (tier, stack, domain, constraints) belong in project config.
Universal principles (philosophy, git workflow, defaults) live here.

---

Generated by KERNEL `/kernel:user-init`
Source: CODING-PROMPT-BANK v1.1
Last updated: {TIMESTAMP}
```

Replace `{TIMESTAMP}` with current UTC timestamp.

## Step 7: Create/Update Changelog

Write to `~/.claude/changelog.md`:

```markdown
# KERNEL User Configuration Changelog

---

## {DATE} {TIME} (UTC)
**Action:** [Initial installation | Update] via /kernel:user-init
**Source:** CODING-PROMPT-BANK v1.1
**Files:** ~/.claude/CLAUDE.md, ~/.claude/rules/, ~/.claude/changelog.md
**Preferences:** [Customized | Defaults]
```

## Step 8: Report

Output summary:

```
KERNEL User Foundations Installed

Location: ~/.claude/

Created:
  ~/.claude/CLAUDE.md      - Universal principles (always loaded)
  ~/.claude/rules/         - User rules directory
  ~/.claude/changelog.md   - Change tracking

Content extracted from CODING-PROMPT-BANK:
  - Core Philosophy (CORRECTNESS > SPEED, etc.)
  - Git Workflow (worktree-based isolated development)
  - Defaults (clarity, explicit, existing patterns)
  - Quick Reference (checklists)

Git Workflow Summary:
  Create worktrees for isolated work (never work directly on main):

  git worktree add -b feat/my-feature ../project-feat-my-feature
  open -a Terminal ../project-feat-my-feature

Next steps:
  1. Customize ~/.claude/CLAUDE.md response preferences
  2. Add user rules to ~/.claude/rules/ as patterns emerge
  3. Run /kernel:init in projects to add project-specific config

Note: These foundations apply to ALL Claude Code sessions.
Project-level config (when present) takes precedence.
```

## Dynamic Generation Rules

When extracting from CODING-PROMPT-BANK:

1. **Preserve formatting**: Keep code blocks and structure
2. **Adapt platform**: If user specified macOS/Linux/Windows, adjust commands
3. **Remove project-specific**: Don't include COMPLEXITY TIERS, PROJECT TEMPLATE, etc.
4. **Keep universal**: Only sections that apply regardless of project

## Behavior Notes

- **Bank-driven**: Content comes from CODING-PROMPT-BANK, not hardcoded
- **Preference-aware**: Can customize based on user input
- **Backup before mutation**: Always preserves existing config
- **Changelog tracking**: Documents all changes for auditability
- **Idempotent**: Safe to run multiple times (will offer update option)
