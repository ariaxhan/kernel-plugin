---
description: Initialize KERNEL for project - builds project-specific CLAUDE.md from bank + enables artifact creation
allowed-tools: Read, Write, Glob, Bash, Grep, AskUserQuestion
---

# Initialize KERNEL (Project-Level)

Build a project-specific CLAUDE.md using CODING-PROMPT-BANK.md as substrate.

**Architecture:**
```
PRECEDENCE: Project > User > Plugin

~/.claude/CLAUDE.md       <-- Universal (user-init)
./CLAUDE.md + kernel/     <-- Project-specific (THIS command)
```

## Step 0: Check User-Level Installation

```bash
ls ~/.claude/CLAUDE.md 2>/dev/null || echo "NOT_FOUND"
```

**If NOT_FOUND:**
```
User-level KERNEL not installed.

The user-level config (~/.claude/CLAUDE.md) contains universal principles
that apply to ALL projects. Project-level config adds specifics.

Options:
  1. Run /kernel:user-init first (recommended)
  2. Continue anyway (project-level only)
```

Ask user which option. If they choose 1, stop and let them run user-init first.

## Step 1: Read Configuration Types Guide

**CRITICAL**: Before creating ANY artifacts, read CONFIG-TYPES.md in the plugin root.

This guide defines WHEN to use:
- AGENTS vs SKILLS vs COMMANDS vs RULES vs HOOKS vs MCP

If CONFIG-TYPES.md doesn't exist in the target project, copy it from the plugin location.

## Step 2: Locate CODING-PROMPT-BANK

Search for CODING-PROMPT-BANK.md in order:
1. Project root (if customized)
2. Plugin location: `kernel/banks/CODING-PROMPT-BANK.md`

Read the entire bank. Extract sections tagged `[PROJECT-LEVEL]`:
- COMPLEXITY TIERS
- TESTING REQUIREMENTS
- PROJECT TEMPLATE
- VALIDATION PROTOCOL (adapt per stack)

**Do NOT extract `[USER-LEVEL]` sections** - those belong in `~/.claude/CLAUDE.md`.

## Step 3: Analyze Project

Gather intel:
- README.md → purpose, domain
- package.json / pyproject.toml / Cargo.toml / go.mod → stack, dependencies
- Existing tests → testing patterns
- .github/workflows → CI patterns
- Existing .claude/ → prior config

Determine:
- **TIER**: 1 (hackathon), 2 (default), or 3 (critical)
- **STACK**: Primary language, framework, tools
- **DOMAIN**: What kind of project (API, CLI, library, app)

## Step 4: Create Directory Structure

```
.claude/
├── commands/
├── agents/
├── skills/
├── rules/
kernel/
├── banks/      (methodology banks)
├── commands/   (kernel commands)
├── state.md    (project state)
```

## Step 5: Build Project CLAUDE.md

Create `.claude/CLAUDE.md` with PROJECT-SPECIFIC content only:

```markdown
# [PROJECT NAME]

**TIER:** [1-3]
**STACK:** [detected stack]
**DOMAIN:** [api/cli/library/app/other]

---

## Project Constraints

[Discovered or user-specified constraints]

---

## Coding Rules (Project-Specific)

[Selected sections from CODING-PROMPT-BANK.md relevant to this tier/stack]

### Tier [X] Requirements
[From COMPLEXITY TIERS section, only the relevant tier]

### Testing Requirements
[From TESTING REQUIREMENTS section, adapted for stack]

### Validation Protocol
[From VALIDATION PROTOCOL section, adapted for project]

---

## KERNEL: Self-Evolving Configuration

KERNEL progressively builds Claude Code config based on observed patterns.

### Pattern → Artifact Mapping

| When You Notice... | Create This |
|-------------------|-------------|
| Same multi-step workflow repeated 2+ times | `.claude/commands/workflow-name.md` |
| Task needing specialized expertise | `.claude/agents/specialist-name.md` |
| External service integration needed | Entry in `.mcp.json` |
| Pre/post processing on tool usage | Hook in `.claude/settings.json` |
| Domain capability used repeatedly | `.claude/skills/capability/SKILL.md` |
| User states explicit preference | `.claude/rules/topic.md` |

### Guidelines

- Conservative: Clear, repeated patterns only
- Minimal: Start simple
- Ask first: Confirm if unsure
- Check existing: Avoid duplicates
- **Read CONFIG-TYPES.md before creating artifacts**

### On-Demand Methodology

Methodology banks available via commands (zero token cost until used):

- `/discover` — Map codebase, populate state
- `/plan` — Get-it-right-first-time planning (loads PLANNING-BANK)
- `/debug` — Systematic diagnosis (loads DEBUGGING-BANK)
- `/review` — Correctness validation (loads REVIEW-BANK)
- `/branch` — Create worktree for isolated development
- `/ship` — Commit, push, create PR
- `/parallelize` — Set up multiple worktrees for parallel streams

### Living Knowledge

- `kernel/state.md` — Current project reality (read first when uncertain)
- `kernel/banks/` — Methodology references (load via commands)
- `.claude/rules/` — Project patterns (evolves over time)

---

## Relationship to User-Level Config

Universal principles (philosophy, git workflow, defaults) live in `~/.claude/CLAUDE.md`.
This file contains PROJECT-SPECIFIC additions that take precedence.

**Full precedence chain:**
1. This file (project-specific, highest priority)
2. ~/.claude/CLAUDE.md (universal principles)
3. Plugin defaults (lowest priority)

---

Generated by KERNEL `/kernel:init`
Source: CODING-PROMPT-BANK v1.1
Last updated: {TIMESTAMP}
```

## Step 6: Copy Methodology Banks

**From plugin kernel/banks/ → project kernel/banks/:**
- `PLANNING-BANK.md`
- `DEBUGGING-BANK.md`
- `REVIEW-BANK.md`
- `DISCOVERY-BANK.md`
- `CODING-PROMPT-BANK.md`

**Note**: Banks are NOT loaded by default (zero token cost until referenced via commands).

## Step 7: Copy Commands

**From plugin kernel/commands/ → project kernel/commands/:**
- `discover.md`
- `plan.md`
- `debug.md`
- `review.md`
- `branch.md`
- `ship.md`
- `parallelize.md`
- `handoff.md`

Also copy to `.claude/commands/` for Claude Code discovery.

## Step 8: Create Starter Files

- `.claude/rules/preferences.md` with header
- `kernel/state.md` with initial template
- `.mcp.json` if not exists
- `.claude/settings.json` if not exists

## Step 9: Report

```
KERNEL Initialized for [PROJECT NAME]

Detected:
  TIER: [tier] — [explanation]
  STACK: [stack]
  DOMAIN: [domain]

Created:
  .claude/CLAUDE.md         — Project-specific config
  .claude/commands/         — [count] commands
  .claude/rules/            — Starter rules
  kernel/banks/             — [count] methodology banks
  kernel/commands/          — [count] kernel commands
  kernel/state.md           — Project state tracker

User-Level Config:
  [Found at ~/.claude/CLAUDE.md | NOT FOUND - run /kernel:user-init]

Content Source:
  CODING-PROMPT-BANK v1.1

Available Commands:
  /discover  — Map codebase and populate state
  /plan      — Planning mode
  /debug     — Debugging mode
  /review    — Review mode
  /branch    — Create worktree for work
  /ship      — Push and create PR
  /parallelize — Parallel worktrees

Next steps:
  1. Run /discover to populate kernel/state.md
  2. Use /branch before starting any work
  3. Patterns emerge → artifacts evolve
```

## Key Differences from User-Init

| User-Init (`~/.claude/`) | Project-Init (`./`) |
|--------------------------|---------------------|
| Universal philosophy | Project tier/stack/domain |
| Git workflow | Testing requirements |
| Defaults | Validation protocol |
| Response preferences | Project constraints |
| Applies to ALL projects | Applies to THIS project |
| Run once per machine | Run once per project |

## Anti-Patterns

- **DON'T duplicate** universal content already in `~/.claude/CLAUDE.md`
- **DON'T skip** user-level check (at least warn if missing)
- **DON'T create** project-level versions of git workflow, philosophy, defaults
